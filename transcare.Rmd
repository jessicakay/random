---
title: "SWAN international presentation figures"
output: html_notebook
---

Start those engines...

```{r}
load_packages <- function(){library(rvest)
                            library(dplyr)
                            library(sf)
                            library(sp)}
if("rvest" %in% installed.packages()[,1]==TRUE){load_packages()} 
if("rvest" %in% installed.packages()[,1]==FALSE){
  install.packages("rvest","dplyr", "sf", "sp")
  load_packages()}

```

### import *ACLU anti-trans bill tracker* & clean the data

```{r}


  seed<-"https://www.aclu.org/past-legislation-affecting-lgbt-rights-across-country-"

  for(b in 2018:2020){
    flush.console()
    u<-paste(seed,toString(b),sep="")
    print(b)
    assign(paste("bills",b,sep=""),read_html(u) %>% html_table())
  }

  hc2018 <-  as.data.frame(bills2018[6])[-1,][-c(2,4)] 
  hc2019 <-  as.data.frame(bills2019[9])[-1,]
  hc2020 <-  as.data.frame(bills2020[1])[-1,]
  hc2021 <- as.data.frame(html_table(read_html("https://www.aclu.org/legislation-affecting-lgbt-rights-across-country"))[1])[-1,]
  
  hc2018$year <- 2018
  hc2019$year <- 2019
  hc2020$year <- 2020
  hc2021$year <- 2021
  
  bind_rows(hc2018,hc2019,hc2020) -> hc20xx
  names(hc20xx[1])<-"STUSPS"
  bind_rows(hc20xx,hc2021)->all_bills
  names(all_bills$X1)<-"STUSPS"
  
```

build the *maps*

```{r}
  

  shapefile <- "/Users/jessa/Downloads/tl_2017_us_state/tl_2017_us_state.shp"
  shape <- st_read(shapefile)
  as.data.frame(all_bills)-> healthcare
  names(healthcare)[1]<-"STUSPS"
  merge(shape,healthcare, by=c("STUSPS")) -> tracker_shape_object
  
  ggplot()+
    geom_sf(data = shape,fill="white")+
    geom_sf(data=tracker_shape_object,fill="red",alpha=0.3)+
    xlim(c(130,60))+
    ylim(c(20,50))+
    theme(panel.grid.major = element_line(colour = "transparent"))+
    theme(legend.position = "none")+
    theme_minimal()+
    coord_sf(datum = NA) -> all_map
  
  ggplot()+
    geom_sf(data = shape,fill="white")+
    geom_sf(data=tracker_shape_object,fill="red",alpha=0.4)+
    xlim(c(130,60))+
    ylim(c(20,50))+
    theme(panel.grid.major = element_line(colour = "transparent"))+
    theme(legend.position = "none")+
    theme_minimal()+
    coord_sf(datum = NA)+
    facet_wrap(.~year,ncol=2)+
    labs(caption="data source: ACLU,\nshapefile: US census") -> by_year_map

  gridExtra::grid.arrange(all_map, by_year_map)
  
  
```

